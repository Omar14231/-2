local player = game.Players.LocalPlayer
local moving = false
local autoFarmActive = false 
local speed = 0.25 

-- المسار النهائي المعتمد
local pathPoints = {
    Vector3.new(-72.78, 51.13, 1270.79), Vector3.new(-5.46, 28.46, 1779.85),
    Vector3.new(-32.01, 47.55, 3045.53), Vector3.new(-8.25, 47.76, 4879.98),
    Vector3.new(-26.87, 34.45, 6132.43), Vector3.new(-44.82, 67.09, 7738.29),
    Vector3.new(-34.07, 43.77, 8634.11), Vector3.new(-31.30, -119.20, 8913.29),
    Vector3.new(-55.55, -360.03, 9448.37), Vector3.new(-55.49, -360.03, 9456.23),
    Vector3.new(-55.81, -360.03, 9463.13), Vector3.new(-55.15, -360.03, 9470.97),
    Vector3.new(-56.32, -360.03, 9478.01), Vector3.new(-56.82, -360.03, 9484.51)
}

-- إعداد الواجهة
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "FinalStopBoatFarm"
screenGui.Parent = game.CoreGui
screenGui.ResetOnSpawn = false

-- زر On/Off القابل للسحب
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 100, 0, 40)
toggleButton.Position = UDim2.new(0.45, 0, 0.05, 0)
toggleButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
toggleButton.Text = "Off"
toggleButton.TextColor3 = Color3.fromRGB(255, 0, 0)
toggleButton.Font = Enum.Font.GothamBold
toggleButton.Draggable = true 
toggleButton.Active = true
toggleButton.Parent = screenGui
Instance.new("UICorner", toggleButton)

-- زر Stop المتغير الألوان
local stopButton = Instance.new("TextButton")
stopButton.Size = UDim2.new(0, 90, 0, 40)
stopButton.Position = UDim2.new(0.85, 0, 0.02, 0)
stopButton.Text = "Stop"
stopButton.TextColor3 = Color3.fromRGB(255, 255, 255)
stopButton.Font = Enum.Font.GothamBold
stopButton.Visible = false
stopButton.Parent = screenGui
Instance.new("UICorner", stopButton)

-- نظام تغيير ألوان زر Stop
task.spawn(function()
    while true do
        for i = 0, 1, 0.01 do
            if stopButton.Visible then
                stopButton.BackgroundColor3 = Color3.fromHSV(i, 0.8, 0.8)
            end
            task.wait(0.05)
        end
    end
end)

-- وظيفة الحركة
local function runPath()
    if not autoFarmActive then return end
    moving = true
    toggleButton.Visible = false 
    stopButton.Visible = true 
    
    local char = player.Character or player.CharacterAdded:Wait()
    local hrp = char:WaitForChild("HumanoidRootPart")

    pcall(function() workspace.ItemSaves[player.Name].CreateShip:FireServer() end)

    for _, point in pairs(pathPoints) do
        if not autoFarmActive then break end
        for _, part in pairs(char:GetDescendants()) do
            if part:IsA("BasePart") then part.CanCollide = false end
        end
        repeat
            task.wait()
            hrp.CFrame = hrp.CFrame:Lerp(CFrame.new(point), speed)
            hrp.Velocity = Vector3.new(0,0,0)
        until (hrp.Position - point).Magnitude < 2 or not autoFarmActive
    end
    moving = false
end

-- إعادة التشغيل التلقائي (5 ثوانٍ)
player.CharacterAdded:Connect(function()
    if autoFarmActive then
        toggleButton.Visible = true
        toggleButton.Active = false 
        stopButton.Visible = false 
        
        for i = 5, 1, -1 do
            if not autoFarmActive then break end
            toggleButton.Text = tostring(i) .. "s"
            toggleButton.TextColor3 = Color3.fromRGB(255, 165, 0)
            task.wait(1)
        end
        
        if autoFarmActive then 
            toggleButton.Active = true 
            runPath() 
        end
    end
end)

-- عمل زر التشغيل
toggleButton.MouseButton1Click:Connect(function()
    if not autoFarmActive and toggleButton.Active then
        autoFarmActive = true
        toggleButton.Text = "On"
        toggleButton.TextColor3 = Color3.fromRGB(0, 255, 0)
        runPath()
    end
end)

-- عمل زر Stop المعدل (مع عد تنازلي عند الإيقاف)
stopButton.MouseButton1Click:Connect(function()
    autoFarmActive = false
    moving = false
    stopButton.Visible = false
    toggleButton.Visible = true
    toggleButton.Active = false -- قفل الزر أثناء عد الإيقاف
    
    -- تصفير الحركة
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        player.Character.HumanoidRootPart.Velocity = Vector3.new(0,0,0)
    end

    -- عد تنازلي 5 ثوانٍ قبل التحول لـ Off
    for i = 5, 1, -1 do
        toggleButton.Text = tostring(i) .. "s"
        toggleButton.TextColor3 = Color3.fromRGB(255, 100, 0) -- لون مغاير للتمييز
        task.wait(1)
    end

    toggleButton.Text = "Off"
    toggleButton.TextColor3 = Color3.fromRGB(255, 0, 0)
    toggleButton.Active = true -- الآن مسموح بالضغط مرة أخرى
end)

